<?xml version="1.0"?>
<!--
    $Revision: 1.9 $
    $Date: 2002/10/27 12:11:45 $
    $Author: billhorsman $

    http://proxool.sourceforge.net

-->
<project name="Proxool" default="build-jar" basedir=".">

    <!-- Use this to avoid having to pass properties in the command line -->
    <property file="proxool-ant.properties"/>

    <!-- The target JDK (dictates which source files we use) -->
    <property name="jdk" value="1.3"/>

    <!-- Whether to include the test classes -->
    <property name="test" value="false"/>

    <!-- Whether to include the Avalon dependent classes -->
    <property name="ext.avalon" value="false"/>

    <!-- Whether to include the JAXP dependent classes -->
    <property name="ext.xml" value="false"/>

    <!-- Where to build everything. You might want to override
    this so that it isn't within your cvs tree. -->
    <property name="build-dir" value="build"/>

    <!-- Whether we include debug information in JAR file -->
    <property name="debug" value="false"/>

    <!-- Current version -->
    <property name="version" value="0.4"/>

    <!-- Log4J configuration to use for testing. See proxool-ant.properties
    file for more infomation. -->
    <property name="log4jPath" value=""/>

    <!-- Classpath -->
    <path id="classpath" path="${build-dir}/classes" >
        <fileset dir="lib">
            <include name="**/*.jar"/>
        </fileset>
    </path>

    <taskdef name="checkstyle" classname="com.puppycrawl.tools.checkstyle.CheckStyleTask">
        <classpath refid="classpath"/>
    </taskdef>

    <!--
        Build necessary directories
       -->
    <target
        name="init"
        >
        <mkdir dir="${build-dir}/src/java" description="make source directory" />
        <mkdir dir="${build-dir}/etc"/>
        <mkdir dir="${build-dir}/deploy"/>
        <mkdir dir="${build-dir}/classes"/>
        <mkdir dir="${build-dir}/api"/>
        <mkdir dir="${build-dir}/api-dev"/>
        <tstamp/>
    </target>

    <target
        name="evaluate-properties"
        >

        <!--
            Evaluate whether we should build the source code
            for JDK1.2
           -->
        <condition property="build-jdk1.2">
            <equals arg1="${jdk}" arg2="1.2"/>
        </condition>

        <!--
            Evaluate whether we should build the source code
            with test classes
           -->
        <condition property="build-test">
            <equals arg1="${test}" arg2="true"/>
        </condition>

        <!--
            Evaluate whether we should include the AvalonConfigurator
           -->
        <condition property="build-avalon">
            <equals arg1="${ext.avalon}" arg2="true"/>
        </condition>

        <!--
            Evaluate whether we should include the XMLConfigurator
           -->
        <condition property="build-xml">
            <equals arg1="${ext.xml}" arg2="true"/>
        </condition>

    </target>

    <target
        name="clean"
        description="Cleans build directory"
        >
        <delete dir="${build-dir}"/>
    </target>

    <target
        name="checkstyle"
        description="Checks Java code for style"
        >
        <checkstyle>

            <fileset dir="src/java" includes="**/*.java"/>
            <fileset dir="src/java-examples" includes="**/*.java"/>
            <fileset dir="src/java-ext" includes="**/*.java"/>
            <fileset dir="src/java-jdk1.2" includes="**/*.java"/>
            <fileset dir="src/java-test" includes="**/*.java"/>

            <property key="checkstyle.require.version" value="true"/>
            <property key="checkstyle.javadoc.scope" value="nothing"/>
            <property key="checkstyle.maxlinelen" value="200"/>
            <property key="checkstyle.tab.width" value="4"/>

        </checkstyle>
    </target>

    <target
        name="build-src"
        description="Gathers the source code together ready for compiling"
        depends="init,evaluate-properties"
        >
        <antcall target="build-src-core"/>
        <antcall target="build-src-jdk1.2"/>
        <antcall target="build-src-avalon"/>
        <antcall target="build-src-xml"/>
        <antcall target="build-src-test"/>
    </target>

    <target
        name="compile"
        description="Compiles the code"
        depends="init,build-src"
        >
        <echo message="debug=${debug}"/>
        <javac srcdir="${build-dir}/src/java" destdir="${build-dir}/classes" debug="${debug}">
            <classpath refid="classpath"/>
		</javac>
    </target>

    <target
        name="build-jar"
        description="Compiles and builds the JAR file"
        depends="init,build-src,compile"
        >
        <manifest file="${build-dir}/etc/MANIFEST.MF" >
            <attribute name="Proxool-Version" value="${version}"/>
            <attribute name="Date" value="${TODAY}"/>
        </manifest>
        <jar
            jarfile="${build-dir}/proxool-${version}.jar"
            basedir="${build-dir}/classes"
            manifest="${build-dir}/etc/MANIFEST.MF"
            />
    </target>

    <target
        name="build-src-core"
        depends="init"
        >
        <copy todir="${build-dir}/src/java" preservelastmodified="yes">
            <fileset dir="src/java" includes="**/*.java"/>
            <fileset dir="src/java-ext" includes="**/PropertyConfigurator.java"/>
        </copy>
    </target>

    <target
        name="build-src-jdk1.2"
        depends="init"
        if="build-jdk1.2"
        >
        <echo level="verbose" message="Collecting JDK1.2 classes"/>
        <copy todir="${build-dir}/src/java" overwrite="yes">
            <fileset dir="src/java-jdk1.2" includes="**/*.java"/>
        </copy>
    </target>

    <target
        name="build-src-test"
        depends="init"
        if="build-test"
        >
        <echo level="verbose" message="Collecting test classes"/>
        <copy todir="${build-dir}/src/java">
            <fileset dir="src/java-test" includes="**/*.java"/>
        </copy>
    </target>

    <target
        name="build-src-avalon"
        depends="init"
        if="build-avalon"
        >
        <echo level="verbose" message="Collecting Avalon classes"/>
        <copy todir="${build-dir}/src/java">
            <fileset dir="src/java-ext" includes="**/AvalonConfigurator.java"/>
        </copy>
    </target>

    <target
        name="build-src-xml"
        depends="init"
        if="build-xml"
        >
        <echo level="verbose" message="Collecting XML classes"/>
        <copy todir="${build-dir}/src/java">
            <fileset dir="src/java-ext" includes="**/XMLConfigurator.java"/>
        </copy>
    </target>

    <target
        name="build-test"
        description="Builds the source for running the tests"
        depends="init"
        >
        <property name="build-test" value="true"/>
        <property name="build-ext" value="true"/>
        <antcall target="build-src"/>
        <antcall target="compile"/>
    </target>

    <target
        name="run-test"
        description="Runs the JUnit tests"
        depends="init,build-test"
        >
        <java fork="yes" classpathref="classpath" classname="junit.textui.TestRunner" >
            <sysproperty key="log4jPath" value="${log4jPath}" />
            <arg value="org.logicalcobwebs.proxool.AllTests" />
        </java>
    </target>

    <target
        name="javadoc"
        description="Produce Javadoc API"
        depends="init,build-src,compile">

        <!-- Full documentation for use by developers -->
        <javadoc
            destdir="${build-dir}/api-dev"
            packagenames="org.logicalcobwebs.*"
            doctitle="Proxool Developer's API}"
            windowtitle="Proxool Developer's API}"
            private="true"
        >
            <sourcepath path="src/java" />
            <sourcepath path="src/java-test" />
            <sourcepath path="src/java-ext" />
        </javadoc>

        <!-- Simple documentation for use by users -->
        <javadoc
            sourcepath="src/java"
            destdir="${build-dir}/api"
            packagenames="org.logicalcobwebs.*"
            doctitle="Proxool API}"
            windowtitle="Proxool API}"
            public="true"
        />
    </target>

</project>